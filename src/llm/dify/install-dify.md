# 本地安装 Dify

## Docker Compose 方式安装

### 下载源码
```bash
# 假设当前最新版本为 release/1.0.1-fix1
# clone 需要点时间
git clone https://github.com/langgenius/dify.git
git switch release/1.0.1-fix1
```

### 配置 dify
```bash
# 进入 Dify 源代码的 Docker 目录
cd dify/docker

# 复制环境配置文件
cp .env.example .env

# 修改 pypi 源，安装 LLM 插件需要。
vi .env
```

修改 .env 的内容如下：
```dotenv
# 找到 PIP_MIRROR_URL 修改为阿里云镜像源 或 清华的源。否则安装插件容易失败。
#PIP_MIRROR_URL=https://pypi.tuna.tsinghua.edu.cn/simple
PIP_MIRROR_URL=http://mirrors.aliyun.com/pypi/simple/
```

### 启动 dify
```bash
# -p 参数，指定 docker compose 的名字。
# up 后面加 -d 参数，表示后台运行。我这里不加了，这样可以看到日志，方便调试。
docker compose -p dify up
```

## 使用 dify


第一次访问 http://localhost 时，会转跳到 http://localhost/install 来“设置管理员账户”

<img src="http://static.chenlb.com/img/dify/dify-init-admin.png" width="550" alt="dify-init-admin" />

### 安装大模型服务插件

设置好管理员账户，进行登录。

要使用模型，需要安装插件。我这里本地安装了 ollama 和 vllm 模型服务。可以安装这两个插件：
* Ollama
* OpenAI-API-compatible （OpenAI 兼容的模型服务）

![dify-install-llm-plugin](http://static.chenlb.com/img/dify/dify-install-llm-plugin.png)

### 配置大模型服务

界面右上角，个人头像下拉，点击“设置” -> “模型供应商” 进行配置。

![dify-config-llm](http://static.chenlb.com/img/dify/dify-config-llm.png)


配置 ollama
<img src="http://static.chenlb.com/img/dify/dify-config-ollama.png" width="550" alt="dify-config-ollama" />

用类似的方式增加其它 OpenAI 兼容的大模型服务，如：Qwen2.5-32B-Instruct-AWQ、QwQ-32B-AWQ。

### 使用大模型

在“工作室”创建 空白应用。
![dify-create-blank-app](http://static.chenlb.com/img/dify/dify-create-blank-app.png)

与 qwen2.5:7b 模型对话。
![dify-chat-qwen2.5-7b](http://static.chenlb.com/img/dify/dify-chat-qwen2.5-7b.png)

与 QwQ-32B-AWQ 模型对话。

系统提示：```你是小学语文老师，请用小学生能理解的方式回答。```
对话内容：```我想写一篇“放风筝”的作文，怎么构思呢？```

![dify-chat-qwq-32b-awq](http://static.chenlb.com/img/dify/dify-chat-qwq-32b-awq.png)


## QwQ-32B-AWQ 回答

::: tip 与下是 QwQ-32B-AWQ 的回答：
嗯，用户是想写一篇关于放风筝的作文，需要构思。首先，用户是小学生，所以得用他们能理解的方式。得先想想放风筝的基本要素，比如时间、地点、人物，还有发生了什么有趣的事情。

可能得先确定结构，开头、中间和结尾。开头可以描述天气和心情，比如春天或者某个风和日丽的日子。中间部分要详细写放风筝的过程，比如怎么组装风筝，遇到什么困难，比如风筝飞不起来，怎么解决的。然后最关键的是成功放飞时的喜悦，或者有什么意外情况，比如风筝卡在树上，后来朋友帮忙拽回来，这样的小故事会有趣。

还要注意感官描写，比如风的感觉，风筝的颜色，天空的样子，这样作文会更生动。可能需要加入一些比喻，比如把风筝比作鹅或者小鸟，这样更形象。另外，情感的变化也很重要，从开始的紧张到后来的开心，或者有什么感受要说，比如合作的重要性，或者自由的感觉。

用户可能不知道怎么组织这些元素，需要分步骤引导。首先确定一个故事框架，然后选择具体的细节，比如选择燕子风筝，或者蝴蝶形状的，这样更容易描述。还要避免太复杂的结构，保持简单明了，符合小学生的表达能力。有没有可能忘记的点？比如结尾部分要总结学到了什么，或者为什么这次放风筝的经历难忘，这样能升华主题，让作文更有深度。

可能用户会卡在如何让故事有起伏，这时候可以建议设置一个小问题，比如线缠住了，然后解决，这样故事更有趣。另外，使用对话可以让作文更生动，比如和朋友或家人的对话，表现出互动。还要注意时态，通常用过去式写经历。检查有没有常见的错误，比如动作描写不够具体，或者情感表达不够明确。总之，需要一步步引导他们梳理细节，选择有趣的点，组织成一个连贯的故事。

```</details>```

好的，我来帮小朋友们构思一篇关于 "放风筝" 的作文。我先假设你喜欢春天，喜欢和爸爸妈妈玩耍，这样更容易写呢！

---
**题目：快乐的发现**（或者你取一个更好听的名字）

---

### **开头：先写时间和天气**
先告诉读者你什么时间去哪里放风筝。  
比如：  
" **春天来了，周末的早晨阳光暖暖的，我拉着爸爸的手，抱着蝴蝶形状的风筝，蹦蹦跳跳往公园走。**"

这里要注意：
1. 写"春天来了"说明是好天气；
2. **用动作**：拉、抱、蹦跳可以表现出开心。

---

### **中间：写放风筝的过程和发现**
找一个让风筝飞起来的 **小故事**：
1. **一开始失败**："爸爸让我跑起来，可是风筝总是在天上飘几下就摔下来，像只醉酒的小燕子。"  
   （比喻可以让文字更有趣）
2. **解决方法**："爸爸说要先把线轴按住，跑一段距离再放线。我试了试，结果......"
3. **成功起飞**："只见我的蝴蝶风筝一蹦一跳地向上飞，越飞越高，阳光下翅膀闪闪发亮，好像在和我比谁笑得更开心！"

**这里的小发现**：
- 风筝飞起来需要风力（可以简单写一句："我感觉自己能感觉到风的力度，风小的时候风筝不动，风大的时候它就像被施了魔法一样飞起来"）
- 或发现原来风筝飞在蓝天下特别美（"看着我的风筝和白云玩躲猫猫"）

---

### **结尾：留下感受**
写出你为什么觉得这件事有趣：  
"那天回家，我的口袋里装满了笑声。我明白了， 风筝不是随便就能飞高的 ，但是只要了解它需要什么，它就能给你一个美丽的惊喜。"

---

### **小提示**
- 在开头可以加入你们去公园时看到的其他风筝："天上飘着金鱼、老鹰、熊猫......" 这样画面就活起来了！
- 把你的小风筝起个名字：比如"小蝴蝶"，这样读的人会觉得更亲切。
- 如果你有特别的经历：比如风筝挂在树上，或者被风吹跑，再找回来的故事，更是亮点哦！

要不要试试按照这个结构写呢？相信你一定能把快乐的瞬间记录得很生动！
:::
